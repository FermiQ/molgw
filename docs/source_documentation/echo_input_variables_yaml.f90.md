# `echo_input_variables_yaml.f90`

## Overview

This Fortran source file is designed to output the names and current values of MOLGW's input variables in YAML format. This provides a structured way to log the parameters used for a specific calculation, suitable for machine parsing or inclusion in larger data analysis pipelines. The file is automatically generated by the Python script `input_variables.py` and is not intended for direct manual modification. The content indicates it was last generated on "19 March 2025".

## Key Components

The file consists of a sequence of Fortran `write` statements. It does not define any subroutines, functions, or modules itself. Each `write` statement targets a specific Fortran unit, `unit_yaml`, and formats the output as a YAML key-value pair.

Key characteristics of the output:
*   Standard YAML indentation (4 spaces) is used for each key-value pair.
*   Numerical values (integers and reals) are printed directly.
*   Character string values are typically printed using `TRIM()` to remove trailing spaces.
*   For variables that represent boolean states (often stored as 'yes'/'no' strings in MOLGW), an external function `yesno_to_TrueFalse()` is invoked to convert these to YAML-compliant `True` or `False` string literals.
*   Array variables (e.g., `excit_dir`, `vel_projectile`) are formatted as YAML lists (e.g., `[value1, value2, value3]`).

Example `write` statements:
*   `write(unit_yaml, '(4x,a,18x,i8)') 'acfd_nlambda:', acfd_nlambda`
*   `write(unit_yaml, '(4x,a,18x,es16.8)') 'alpha_hybrid:', alpha_hybrid`
*   `write(unit_yaml, '(4x,a,18x,a)') 'analytic_chi:', yesno_to_TrueFalse(analytic_chi)`
*   `write(unit_yaml, '(4x,a,21x,"[",es16.8,", ",es16.8,", ",es16.8,"]")') 'excit_dir:', excit_dir`

## Important Variables/Constants

*   **`unit_yaml` (Integer)**: This is a Fortran unit number. It is not defined in this file but is expected to be an already opened file unit (connected to a specific output file) in the calling environment. All YAML output is directed to this unit.
*   **Input Variables**: The file references the same comprehensive list of MOLGW input variables as found in `echo_input_variables.f90` (e.g., `alpha_mixing`, `basis`, `nscf`, `postscf`, etc.). Their values are sourced from the MOLGW program's state at the time of execution.

## Usage Examples

This file is intended to be included (e.g., via a Fortran `INCLUDE` statement) within a larger MOLGW program, typically after input processing is complete and a specific file unit has been opened and assigned to `unit_yaml`.

```fortran
subroutine run_calculation_and_log_yaml(input_params, output_yaml_filename)
  ! ...
  ! Initialize MOLGW parameters based on input_params
  ! (all the variables like acfd_nlambda, alpha_hybrid etc. are now set)
  ! ...

  integer :: unit_yaml_file
  open(newunit=unit_yaml_file, file=TRIM(output_yaml_filename), status='replace', action='write')
  
  ! Assign the opened unit to unit_yaml if it's a global/module variable
  ! Or pass unit_yaml_file to a context where unit_yaml is known
  ! For example, if unit_yaml is in a module:
  ! call set_yaml_unit(unit_yaml_file) 
  ! or if unit_yaml is a common block variable, ensure it's set.
  ! Let's assume unit_yaml is accessible and set to unit_yaml_file.

  write(unit_yaml_file, '(a)') "input_parameters:" ! Example: Root key for YAML structure
  
  ! Include the auto-generated YAML output statements
  ! Assuming 'unit_yaml' is the variable name used in echo_input_variables_yaml.f90
  ! and it has been appropriately set to unit_yaml_file.
  INCLUDE 'echo_input_variables_yaml.f90' 

  close(unit_yaml_file)

  ! ... continue with the calculation ...
end subroutine run_calculation_and_log_yaml
```
*(Note: The exact mechanism for making `unit_yaml` available to the included code depends on how variables are managed in MOLGW, e.g., through modules or common blocks.)*

## Dependencies and Interactions

*   **`input_variables.py`**: This external Python script is the generator of `echo_input_variables_yaml.f90`.
*   **MOLGW Input Variables**: Depends on the full set of MOLGW input variables being declared and initialized in the execution scope.
*   **`unit_yaml` Fortran Unit**: Requires that `unit_yaml` is a valid, opened Fortran file unit for writing. The management (opening, closing) of this unit is handled by other parts of the MOLGW code.
*   **`yesno_to_TrueFalse()` function**: This file relies on an external function `yesno_to_TrueFalse(char_variable)` which must be available (e.g., from a module or another source file) to convert 'yes'/'no' like character variables into 'True'/'False' strings.
*   **`TRIM` Intrinsic Function**: Uses the standard Fortran `TRIM` intrinsic function.
*   **YAML Format**: The output is structured to be valid YAML, intended for consumption by YAML parsers or for human-readable structured logging.
*   This file is typically part of the final logging or output stage after inputs are finalized.

```
